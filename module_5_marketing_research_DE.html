<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Marktforschung - Komplettmodul</title>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700&family=Crimson+Text:ital,wght@0,400;0,600;1,400&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-dark: #2c3e50;
            --bg-mid: #34495e;
            --text-primary: #f4f1e8;
            --accent-silver: #bdc3c7;
            --accent-light: #ecf0f1;
            --accent-green: #27ae60;
            --accent-red: #c0392b;
            --accent-blue: #3498db;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'Crimson Text', serif;
            background: linear-gradient(135deg, var(--bg-dark) 0%, var(--bg-mid) 50%, var(--bg-dark) 100%);
            background-size: 400% 400%;
            animation: gradientShift 15s ease infinite;
            color: var(--text-primary);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            overflow-x: hidden;
            padding-bottom: 50px;
        }

        @keyframes gradientShift {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        /* --- UI FRAMEWORK --- */
        .container {
            max-width: 1000px;
            width: 95%;
            margin: 40px auto;
            position: relative;
        }

        .slide-panel {
            background: linear-gradient(135deg, rgba(44, 62, 80, 0.95), rgba(52, 73, 94, 0.95));
            border: 3px solid var(--accent-silver);
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            padding: 5px;
            overflow: hidden;
        }

        header { text-align: center; margin-bottom: 30px; animation: fadeIn 1s ease-out; }

        .pediment {
            background: linear-gradient(135deg, var(--accent-silver) 0%, var(--accent-light) 100%);
            color: var(--bg-dark);
            text-align: center;
            padding: 20px;
            margin-bottom: 20px;
            border-radius: 10px 10px 0 0;
        }

        h1 { font-family: 'Cinzel', serif; font-weight: 700; font-size: 2.5rem; margin-bottom: 5px; text-shadow: 1px 1px 2px rgba(0,0,0,0.1); }
        h2 { font-family: 'Cinzel', serif; color: var(--bg-dark); font-size: 1.8rem; margin: 0; }
        .subtitle { font-family: 'Cinzel', serif; font-size: 1.4rem; color: var(--accent-light); margin-bottom: 5px; }
        .pediment .subtitle { color: var(--bg-mid); }
        .author-credit { font-family: 'Crimson Text', serif; font-size: 0.9rem; font-style: italic; opacity: 0.7; color: var(--accent-silver); }

        /* --- PROGRESS BAR --- */
        .progress-container { width: 100%; background-color: rgba(0,0,0,0.3); border-bottom: 1px solid var(--accent-silver); height: 8px; }
        .progress-bar { height: 100%; background: linear-gradient(90deg, var(--accent-silver), var(--accent-light)); width: 0%; transition: width 0.5s ease; }

        /* --- SECTIONS --- */
        .module { display: none; padding: 40px; min-height: 500px; animation: slideUp 0.6s ease-out; }
        .module.active { display: block; }
        .content-text { font-size: 1.4rem; line-height: 1.7; margin-bottom: 30px; text-align: center; max-width: 800px; margin-left: auto; margin-right: auto; }

        /* --- BUTTONS --- */
        .btn-container { display: flex; justify-content: center; gap: 20px; margin-top: 20px; }
        .btn {
            background: linear-gradient(135deg, var(--bg-mid), var(--bg-dark));
            color: var(--accent-light);
            border: 2px solid var(--accent-silver);
            padding: 12px 30px;
            border-radius: 25px;
            cursor: pointer;
            font-family: 'Cinzel', serif;
            font-size: 1.1rem;
            transition: all 0.4s ease;
            box-shadow: 0 4px 10px rgba(0,0,0,0.3);
            display: inline-block;
        }
        .btn:disabled { opacity: 0.5; cursor: not-allowed; border-color: #7f8c8d; box-shadow: none; }
        .btn:hover:not(:disabled) { background: linear-gradient(135deg, var(--accent-silver), var(--accent-light)); color: var(--bg-dark); transform: translateY(-3px) scale(1.05); box-shadow: 0 8px 20px rgba(0,0,0,0.4); }
        .btn-skip { background: transparent; border: 2px solid rgba(189, 195, 199, 0.5); color: var(--accent-silver); }
        .btn-skip:hover { background: rgba(236, 240, 241, 0.1); color: var(--accent-light); border-color: var(--accent-light); }
        
        /* Small button for next step in exercises */
        .btn-step {
            background: var(--accent-green);
            border: none;
            padding: 8px 20px;
            font-size: 1rem;
            margin-top: 15px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }
        .btn-step:hover { background: #2ecc71; color: white; transform: translateY(-2px); }

        /* --- GAME STYLES --- */
        /* Definition */
        .definition-box { background: rgba(236, 240, 241, 0.05); border: 1px solid rgba(189, 195, 199, 0.3); padding: 30px; border-radius: 10px; margin-bottom: 30px; font-size: 1.3rem; line-height: 2.2; text-align: justify; }
        .drop-blank { display: inline-block; min-width: 150px; height: 35px; border-bottom: 2px solid var(--accent-silver); margin: 0 5px; vertical-align: middle; text-align: center; background: rgba(0,0,0,0.2); border-radius: 4px; color: var(--accent-blue); font-weight: bold; font-family: 'Cinzel', serif; font-size: 1rem; line-height: 35px; padding: 0 10px; }
        .drop-blank.filled { border-bottom: 2px solid var(--accent-green); background: rgba(39, 174, 96, 0.1); }
        .word-bank { display: flex; justify-content: center; flex-wrap: wrap; gap: 15px; margin-top: 20px; }
        .word-chip { background: linear-gradient(135deg, var(--accent-light), var(--accent-silver)); color: var(--bg-dark); padding: 10px 20px; border-radius: 20px; font-weight: bold; cursor: grab; user-select: none; box-shadow: 0 3px 8px rgba(0,0,0,0.3); font-family: 'Cinzel', serif; }
        .word-chip:active { cursor: grabbing; transform: scale(0.95); }
        .word-chip.used { opacity: 0.3; cursor: default; pointer-events: none; }

        /* Sorting (Buckets) */
        .sorting-arena { display: flex; gap: 20px; justify-content: space-around; flex-wrap: wrap; margin-top: 30px; }
        .bucket { width: 30%; min-width: 200px; min-height: 250px; background: rgba(236, 240, 241, 0.1); border: 2px dashed var(--accent-silver); border-radius: 10px; padding: 20px; text-align: center; transition: all 0.3s; }
        .bucket.drag-over { background: rgba(236, 240, 241, 0.25); border-color: #fff; transform: scale(1.02); }
        .bucket h3 { font-family: 'Cinzel', serif; color: var(--accent-silver); margin-bottom: 10px; font-size: 1.2rem; border-bottom: 1px solid rgba(189, 195, 199, 0.3); padding-bottom: 10px; }
        .card-stack { width: 100%; display: flex; justify-content: center; margin-bottom: 30px; height: 120px; }
        .card { background: linear-gradient(135deg, var(--accent-light), var(--accent-silver)); color: var(--bg-dark); padding: 15px 25px; border-radius: 8px; font-weight: bold; font-size: 1.1rem; cursor: grab; box-shadow: 0 5px 15px rgba(0,0,0,0.3); user-select: none; position: absolute; z-index: 50; width: 260px; text-align: center; display: flex; align-items: center; justify-content: center; gap: 10px; }
        .card:active { cursor: grabbing; }

        /* Sequencing */
        .sequence-container { display: flex; flex-direction: column; gap: 15px; max-width: 800px; margin: 0 auto; }
        .sequence-slot { background: rgba(236, 240, 241, 0.05); border: 1px solid rgba(189, 195, 199, 0.3); padding: 15px; border-radius: 8px; display: flex; align-items: center; gap: 15px; }
        .step-number { font-family: 'Cinzel', serif; font-size: 1.8rem; color: var(--accent-silver); width: 50px; text-align: center; font-weight: bold; }
        .draggable-step { flex-grow: 1; background: linear-gradient(135deg, var(--bg-mid), var(--bg-dark)); padding: 18px; border-radius: 6px; cursor: grab; border: 1px solid var(--accent-silver); display: flex; justify-content: space-between; align-items: center; color: var(--accent-light); font-size: 1.1rem; box-shadow: 0 2px 5px rgba(0,0,0,0.2); transition: transform 0.2s; }
        .draggable-step:active { cursor: grabbing; transform: scale(0.98); }

        /* Mixer / Scenario Options */
        .mixer-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 25px; margin-top: 30px; }
        .mixer-card { background: rgba(236, 240, 241, 0.1); padding: 25px; border-radius: 10px; text-align: center; border: 2px solid transparent; cursor: pointer; transition: all 0.3s; }
        .mixer-card:hover { background: rgba(236, 240, 241, 0.15); transform: translateY(-5px); box-shadow: 0 8px 25px rgba(0,0,0,0.2); }
        .mixer-card.selected { border-color: var(--accent-silver); background: rgba(236, 240, 241, 0.2); box-shadow: 0 0 15px rgba(189, 195, 199, 0.3); }
        .mixer-icon { font-size: 2.5rem; margin-bottom: 15px; display: block; }
        
        /* Contact Scenario */
        .scenario-box { background: rgba(236, 240, 241, 0.1); padding: 20px; border-radius: 10px; margin-bottom: 25px; text-align: center; font-size: 1.3rem; border: 1px solid var(--accent-silver); }
        .options-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 20px; }
        .option-card { background: rgba(44, 62, 80, 0.8); border: 2px solid var(--accent-silver); padding: 15px; border-radius: 8px; cursor: pointer; text-align: center; transition: all 0.3s; display: flex; align-items: center; justify-content: center; height: 100%; min-height: 80px; }
        .option-card:hover { background: var(--accent-light); color: var(--bg-dark); transform: translateY(-3px); }

        /* Quiz */
        .quiz-option { background: rgba(255, 255, 255, 0.05); margin: 10px 0; padding: 15px; border-radius: 8px; cursor: pointer; border: 1px solid transparent; transition: all 0.2s; text-align: left; }
        .quiz-option:hover { background: rgba(255, 255, 255, 0.1); border-color: var(--accent-silver); }
        .quiz-option.selected-correct { background: rgba(39, 174, 96, 0.3); border-color: var(--accent-green); }
        .quiz-option.selected-wrong { background: rgba(192, 57, 43, 0.3); border-color: var(--accent-red); }

        /* Feedback */
        .feedback-area { min-height: 60px; margin-top: 25px; text-align: center; font-weight: bold; font-size: 1.2rem; padding: 10px; border-radius: 5px; display: flex; flex-direction: column; align-items: center; justify-content: center; }
        .success { color: var(--accent-green); margin-bottom: 10px; display: block; }
        .error { color: var(--accent-red); margin-bottom: 10px; display: block; }
        .explanation-text { font-size: 1rem; color: var(--accent-silver); font-weight: normal; margin-bottom: 10px; display: block; max-width: 800px; }
        .hidden { display: none; }

        @keyframes slideUp { from { transform: translateY(20px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        @media (max-width: 768px) {
            h1 { font-size: 2rem; }
            .module { padding: 25px 15px; }
            .sorting-arena { flex-direction: column; align-items: center; }
            .bucket { width: 90%; }
            .options-grid, .mixer-grid { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>

    <header>
        <h1 style="color: var(--accent-silver);">Grundlagen des Marketing</h1>
        <div class="subtitle">Modul 5: Marktforschung</div>
        <div class="author-credit">erstellt von Matthias Glaser, PhD - mit Gemini 3/Claude Sonnet 4.5 (entsprechende Einschr√§nkungen gelten)</div>
    </header>

    <div class="container slide-panel">
        <div class="progress-container">
            <div class="progress-bar" id="progress-bar"></div>
        </div>

        <!-- MODULE 0: INTRO -->
        <div class="module active" id="mod-intro">
            <div class="pediment">
                <h2>√úbersicht</h2>
                <div class="subtitle">Was Sie erwartet</div>
            </div>
            <div class="content-text">
                <p>Dieses Modul umfasst √úbungen zu:</p>
                <ul style="text-align: left; max-width: 600px; margin: 0 auto; line-height: 1.6;">
                    <li>1. Nutzen der Marktforschung</li>
                    <li>2. Forschungsziele</li>
                    <li>3. Prozess einer Studie</li>
                    <li>4. Marketing-Informationssystem</li>
                    <li>5. Datenwahl</li>
                    <li>6. Kontaktmethoden</li>
                    <li>7. Stichproben</li>
                    <li>8. Stichprobenplanung</li>
                </ul>
            </div>
            <div class="btn-container">
                <button class="btn" onclick="nextModule(1)">Starten</button>
            </div>
        </div>

        <!-- MODULE 1: DEFINITION -->
        <div class="module" id="mod-def">
            <div class="pediment">
                <h2>1. Nutzen der Marktforschung</h2>
                <div class="subtitle">Definition & Zweck</div>
            </div>
            <div class="content-text">
                <p>Vervollst√§ndigen Sie die Definition und den Nutzen der Marktforschung (cf. Kotler et al. 2019: 197).</p>
            </div>
            <div class="definition-box">
                "Die Marktforschung stellt die 
                <span class="drop-blank" data-target="Verbindung" ondragover="allowDropDef(event)" ondrop="dropDef(event)"></span> 
                von der Marketingabteilung zu den 
                <span class="drop-blank" data-target="Verbrauchern" ondragover="allowDropDef(event)" ondrop="dropDef(event)"></span>, 
                den Kunden und zur 
                <span class="drop-blank" data-target="√ñffentlichkeit" ondragover="allowDropDef(event)" ondrop="dropDef(event)"></span> 
                her. Ihre Informationen werden gebraucht, um 
                <span class="drop-blank" data-target="Marketingchancen" ondragover="allowDropDef(event)" ondrop="dropDef(event)"></span> 
                und Marketingprobleme zu erkennen, Marketingaktionen zu konzipieren/optimieren und auf Wirksamkeit zu √ºberpr√ºfen, die 
                <span class="drop-blank" data-target="Marketingleistung" ondragover="allowDropDef(event)" ondrop="dropDef(event)"></span> 
                zu messen und das Marketinggeschehen zu verstehen."
            </div>
            <div class="word-bank" id="definition-words"></div>
            <div class="feedback-area" id="feedback-def"></div>
            <div class="btn-container">
                <button class="btn btn-skip" onclick="skipAndNext(2)">√úberspringen</button>
                <button class="btn" id="btn-next-def" disabled onclick="completeAndNext(2)">Weiter</button>
            </div>
        </div>

        <!-- MODULE 2: OBJECTIVES (Sorting) -->
        <div class="module" id="mod-obj">
            <div class="pediment">
                <h2>2. Forschungsziele</h2>
                <div class="subtitle">Explorativ, Deskriptiv oder Kausal?</div>
            </div>
            <div class="content-text">
                <p>Ordnen Sie die Aufgaben der korrekten Kategorie zu (cf. Kotler et al. 2019: 199).</p>
            </div>
            <div class="card-stack" id="stack-obj"></div>
            <div class="sorting-arena">
                <div class="bucket" data-type="explorativ" ondragover="allowDropObj(event)" ondrop="dropObj(event)">
                    <h3>Explorativ</h3>
                </div>
                <div class="bucket" data-type="deskriptiv" ondragover="allowDropObj(event)" ondrop="dropObj(event)">
                    <h3>Deskriptiv</h3>
                </div>
                <div class="bucket" data-type="ursachen" ondragover="allowDropObj(event)" ondrop="dropObj(event)">
                    <h3>Ursachen</h3>
                </div>
            </div>
            <div class="feedback-area" id="feedback-obj"></div>
            <div class="btn-container">
                <button class="btn btn-skip" onclick="skipAndNext(3)">√úberspringen</button>
                <button class="btn" id="btn-next-obj" style="display:none;" onclick="completeAndNext(3)">Weiter</button>
            </div>
        </div>

        <!-- MODULE 3: PROCESS (Sequence) -->
        <div class="module" id="mod-proc">
            <div class="pediment">
                <h2>3. Prozess einer Studie</h2>
                <div class="subtitle">Ablauf einer Studie</div>
            </div>
            <div class="content-text">
                <p>Bringen Sie die vier Schritte in die korrekte Reihenfolge (cf. Kotler et al. 2019: 198, Abb 4.3).</p>
            </div>
            <div class="sequence-container" id="list-proc"></div>
            <div class="feedback-area" id="feedback-proc"></div>
            <div class="btn-container">
                <button class="btn btn-skip" onclick="skipAndNext(4)">√úberspringen</button>
                <button class="btn" onclick="checkProcessOrder()">Pr√ºfen</button>
            </div>
        </div>

        <!-- MODULE 4: MIS (Sequence) -->
        <div class="module" id="mod-mis">
            <div class="pediment">
                <h2>4. Marketing-Informationssystem</h2>
                <div class="subtitle">Informationsfluss</div>
            </div>
            <div class="content-text">
                <p>Rekonstruieren Sie den Informationsfluss im Marketing-Informationssystem (cf. Kotler et al. 2019: 191, Abb. 4.2).</p>
            </div>
            <div class="sequence-container" id="list-mis"></div>
            <div class="feedback-area" id="feedback-mis"></div>
            <div class="btn-container">
                <button class="btn btn-skip" onclick="skipAndNext(5)">√úberspringen</button>
                <button class="btn" onclick="checkMISOrder()">Pr√ºfen</button>
            </div>
        </div>

        <!-- MODULE 5: MIXER (Scenario) -->
        <div class="module" id="mod-mix">
            <div class="pediment">
                <h2>5. Datenwahl</h2>
                <div class="subtitle">Prim√§r- oder Sekund√§rdaten?</div>
            </div>
            <div class="content-text">
                <p>Entscheiden Sie f√ºr jedes Szenario, welche Datenart am besten geeignet ist.</p>
            </div>
            <div id="mix-game">
                <!-- Steps will be generated dynamically -->
            </div>
            <div class="feedback-area" id="feedback-mix"></div>
            <div class="btn-container">
                <button class="btn btn-skip" onclick="skipAndNext(6)">√úberspringen</button>
                <button class="btn" id="btn-next-mix" style="display:none;" onclick="completeAndNext(6)">Weiter</button>
            </div>
        </div>

        <!-- MODULE 6: CONTACT (Scenario) -->
        <div class="module" id="mod-cont">
            <div class="pediment">
                <h2>6. Kontaktmethoden</h2>
                <div class="subtitle">Kommunikationsformen</div>
            </div>
            <div class="content-text">
                <p>W√§hlen Sie die beste Methode f√ºr das jeweilige Szenario (cf. Kotler et al. 2019: 207).</p>
            </div>
            <div id="contact-game-container"></div>
            <div class="feedback-area" id="feedback-cont"></div>
            <div class="btn-container">
                <button class="btn btn-skip" onclick="skipAndNext(7)">√úberspringen</button>
                <button class="btn" id="btn-next-cont" style="display:none;" onclick="completeAndNext(7)">Weiter</button>
            </div>
        </div>

        <!-- MODULE 7: SAMPLING (Sorting) -->
        <div class="module" id="mod-samp">
            <div class="pediment">
                <h2>7. Stichproben</h2>
                <div class="subtitle">Auswahlverfahren</div>
            </div>
            <div class="content-text">
                <p>Zufallsorientiert oder Nicht-Zufallsorientiert? (cf. Kotler et al. 2019: 215)</p>
            </div>
            <div class="card-stack" id="stack-samp"></div>
            <div class="sorting-arena">
                <div class="bucket" data-type="zufall" ondragover="allowDropSamp(event)" ondrop="dropSamp(event)">
                    <h3>Zufall</h3>
                </div>
                <div class="bucket" data-type="nicht-zufall" ondragover="allowDropSamp(event)" ondrop="dropSamp(event)">
                    <h3>Nicht-Zufall</h3>
                </div>
            </div>
            <div class="feedback-area" id="feedback-samp"></div>
            <div class="btn-container">
                <button class="btn btn-skip" onclick="skipAndNext(8)">√úberspringen</button>
                <button class="btn" id="btn-next-samp" style="display:none;" onclick="completeAndNext(8)">Weiter</button>
            </div>
        </div>

        <!-- MODULE 8: INSTRUMENTS (Quiz) -->
        <div class="module" id="mod-inst">
            <div class="pediment">
                <h2>8. Stichprobenplanung</h2>
                <div class="subtitle">Planung</div>
            </div>
            <div id="quiz-container"></div>
            <div class="feedback-area" id="feedback-inst"></div>
            <div class="btn-container">
                <button class="btn btn-skip" onclick="skipAndNext(9)">√úberspringen</button>
                <button class="btn" id="btn-next-inst" style="display:none;" onclick="completeAndNext(9)">Abschlie√üen</button>
            </div>
        </div>

        <!-- FINAL -->
        <div class="module" id="mod-final" style="text-align: center;">
            <div class="pediment" id="final-heading">
                <h2>Abschluss</h2>
            </div>
            <div id="final-content">
                <!-- Content will be generated by JavaScript based on completion status -->
            </div>
            <button class="btn" onclick="location.reload()">Neustart</button>
        </div>

    </div>

    <script>
        // --- GLOBAL STATE ---
        let currentModule = 0;
        let dragSrcEl = null; // Shared drag source
        let completedModules = new Set(); // Track which modules were actually completed (not skipped)

        document.addEventListener('DOMContentLoaded', () => {
            updateProgress();
            initDefinitionGame(); // Pre-load first game
        });

        function nextModule(n) {
            document.querySelectorAll('.module').forEach(m => m.classList.remove('active'));
            // Mapping numbers to IDs
            let id = 'mod-intro';
            if(n===1) id='mod-def';
            if(n===2) id='mod-obj';
            if(n===3) id='mod-proc';
            if(n===4) id='mod-mis';
            if(n===5) id='mod-mix';
            if(n===6) id='mod-cont';
            if(n===7) id='mod-samp';
            if(n===8) id='mod-inst';
            if(n===9) {
                id='mod-final';
                // Generate final content based on completion status
                updateFinalModule();
            }

            document.getElementById(id).classList.add('active');
            currentModule = n;
            updateProgress();

            // Init games on demand
            if(n===2) initObjGame();
            if(n===3) initProcessGame();
            if(n===4) initMISGame();
            if(n===5) initMixerGame();
            if(n===6) initContactGame();
            if(n===7) initSamplingGame();
            if(n===8) initQuizGame();
        }

        function skipAndNext(n) { nextModule(n); }
        
        function completeAndNext(n) {
            // Mark current module as completed
            completedModules.add(currentModule);
            nextModule(n);
        }

        function updateProgress() {
            // Approx percentages for 9 steps (0-8)
            const p = Math.round((currentModule / 9) * 100);
            document.getElementById('progress-bar').style.width = `${p}%`;
        }
        
        function updateFinalModule() {
            const finalContent = document.getElementById('final-content');
            const totalExercises = 8; // Modules 1-8 are exercises
            
            if (completedModules.size === totalExercises) {
                // All exercises completed - show success message
                finalContent.innerHTML = `
                    <div style="font-size: 4rem; color: var(--accent-green); margin: 20px;">‚úì</div>
                    <div class="content-text">
                        <p><strong>Herzlichen Gl√ºckwunsch!</strong></p>
                        <p>Sie haben alle √úbungen zur Marktforschung erfolgreich abgeschlossen.</p>
                        <p>Von der Definition √ºber den Prozess bis hin zu spezifischen Methoden und Stichprobenverfahren.</p>
                    </div>
                `;
            } else {
                // Some exercises were skipped - show warning message
                const skipped = totalExercises - completedModules.size;
                finalContent.innerHTML = `
                    <div style="font-size: 4rem; color: var(--accent-red); margin: 20px;">‚ö†</div>
                    <div class="content-text">
                        <p><strong>Modul durchlaufen</strong></p>
                        <p>Sie haben ${skipped} ${skipped === 1 ? '√úbung' : '√úbungen'} √ºbersprungen.</p>
                        <p style="color: var(--accent-red); font-weight: bold;">F√ºr ein vollst√§ndiges Verst√§ndnis der Marktforschung ist es wichtig, alle √úbungen durchzuf√ºhren.</p>
                        <p>Bitte starten Sie das Modul neu und bearbeiten Sie alle Aufgaben.</p>
                    </div>
                `;
            }
        }

        // --- SHARED DRAG HANDLERS (Generic) ---
        function dragStart(e) {
            dragSrcEl = this;
            e.dataTransfer.effectAllowed = 'move';
            e.dataTransfer.setData('text/html', this.innerHTML);
            this.style.opacity = '0.4';
        }
        function dragOver(e) { if (e.preventDefault) e.preventDefault(); return false; }
        function dragEnter(e) { this.classList.add('over'); }
        function dragDropGeneric(e) {
            if (e.stopPropagation) e.stopPropagation();
            if (dragSrcEl !== this) {
                // Swap ID and HTML
                const tempHTML = this.innerHTML;
                const tempId = this.dataset.id;
                this.innerHTML = dragSrcEl.innerHTML;
                this.dataset.id = dragSrcEl.dataset.id;
                dragSrcEl.innerHTML = tempHTML;
                dragSrcEl.dataset.id = tempId;
            }
            dragSrcEl.style.opacity = '1';
            return false;
        }


        // --- 1. DEFINITION GAME ---
        const defWords = ["Verbindung", "Verbrauchern", "√ñffentlichkeit", "Marketingchancen", "Marketingleistung"];
        let placedWordsDef = 0;
        function initDefinitionGame() {
            const container = document.getElementById('definition-words');
            container.innerHTML = '';
            [...defWords].sort(() => Math.random() - 0.5).forEach(word => {
                const chip = document.createElement('div');
                chip.className = 'word-chip';
                chip.draggable = true;
                chip.textContent = word;
                chip.dataset.word = word;
                chip.addEventListener('dragstart', (e) => {
                    e.dataTransfer.setData("text", e.target.dataset.word);
                });
                container.appendChild(chip);
            });
        }
        function allowDropDef(ev) { ev.preventDefault(); ev.currentTarget.classList.add('over'); }
        function dropDef(ev) {
            ev.preventDefault();
            ev.currentTarget.classList.remove('over');
            const word = ev.dataTransfer.getData("text");
            const target = ev.currentTarget.dataset.target;
            if (ev.currentTarget.textContent.trim() !== "") return; 
            if (word === target) {
                ev.currentTarget.textContent = word;
                ev.currentTarget.classList.add('filled');
                placedWordsDef++;
                // Mark used
                document.querySelectorAll('.word-chip').forEach(c => {
                    if(c.dataset.word === word && !c.classList.contains('used')) c.classList.add('used');
                });
                if(placedWordsDef === defWords.length) {
                    document.getElementById('feedback-def').innerHTML = "<span class='success'>Richtig!</span>";
                    document.getElementById('btn-next-def').disabled = false;
                }
            } else {
                const fb = document.getElementById('feedback-def');
                fb.innerHTML = "<span class='error'>Falsch.</span>";
                setTimeout(()=>fb.innerHTML="", 1000);
            }
        }

        // --- 2. OBJECTIVES SORTING ---
        const objItems = [
            { id: 1, text: "Erste Infos sammeln", type: "explorativ", icon: "üîç" },
            { id: 2, text: "Marktpotenzial messen", type: "deskriptiv", icon: "üìä" },
            { id: 3, text: "Preiswirkung testen", type: "ursachen", icon: "‚öñÔ∏è" },
            { id: 4, text: "Demografie beschreiben", type: "deskriptiv", icon: "üë•" },
            // "Hypothesen bilden" removed as requested
            { id: 6, text: "Experiment durchf√ºhren", type: "ursachen", icon: "üß™" },
            { id: 7, text: "Neuprodukt-Akzeptanz erforschen", type: "explorativ", icon: "üÜï" },
            { id: 8, text: "Kundenzufriedenheit quantifizieren", type: "deskriptiv", icon: "üòä" },
            { id: 9, text: "Werbewirkung analysieren", type: "ursachen", icon: "üì∫" }
        ];
        let curObjIdx = 0;
        function initObjGame() {
            curObjIdx = 0;
            loadObjCard();
        }
        function loadObjCard() {
            const stack = document.getElementById('stack-obj');
            stack.innerHTML = '';
            if(curObjIdx >= objItems.length) {
                document.getElementById('feedback-obj').innerHTML = "<span class='success'>Erledigt!</span>";
                document.getElementById('btn-next-obj').style.display = 'inline-block';
                return;
            }
            const item = objItems[curObjIdx];
            const card = document.createElement('div');
            card.className = 'card';
            card.draggable = true;
            card.innerHTML = `<span>${item.icon}</span> ${item.text}`;
            card.dataset.type = item.type;
            card.addEventListener('dragstart', (e) => e.dataTransfer.setData("text", item.type));
            stack.appendChild(card);
        }
        function allowDropObj(ev) { ev.preventDefault(); ev.currentTarget.classList.add('drag-over'); }
        function dropObj(ev) {
            ev.preventDefault();
            ev.currentTarget.classList.remove('drag-over');
            const type = ev.dataTransfer.getData("text");
            if(type === ev.currentTarget.dataset.type) {
                document.getElementById('feedback-obj').innerHTML = "<span class='success'>Richtig!</span>";
                curObjIdx++;
                loadObjCard();
            } else {
                document.getElementById('feedback-obj').innerHTML = "<span class='error'>Falsch.</span>";
            }
        }

        // --- 3. PROCESS SEQUENCING ---
        const procSteps = [
            { id: 1, text: "Problemstellung und Ziele" },
            { id: 2, text: "Untersuchungsplan entwickeln" },
            { id: 3, text: "Datenerhebung und -analyse" },
            { id: 4, text: "Interpretation und Kommunikation" }
        ];
        function initProcessGame() {
            const container = document.getElementById('list-proc');
            container.innerHTML = '';
            [...procSteps].sort(() => Math.random() - 0.5).forEach((step, i) => {
                const el = document.createElement('div');
                el.className = 'draggable-step';
                el.draggable = true;
                // Removed :: prefix
                el.innerHTML = `<span>${step.text}</span>`;
                el.dataset.id = step.id;
                el.addEventListener('dragstart', dragStart);
                el.addEventListener('dragover', dragOver);
                el.addEventListener('drop', dragDropGeneric);
                el.addEventListener('dragenter', dragEnter);
                
                const slot = document.createElement('div');
                slot.className = 'sequence-slot';
                slot.innerHTML = `<div class='step-number'>${i+1}</div>`;
                slot.appendChild(el);
                container.appendChild(slot);
            });
        }
        function checkProcessOrder() {
            const steps = document.querySelectorAll('#list-proc .draggable-step');
            let correct = 0;
            steps.forEach((s, i) => { if(parseInt(s.dataset.id) === i+1) correct++; });
            if(correct === 4) {
                document.getElementById('feedback-proc').innerHTML = "<span class='success'>Korrekt!</span>";
                setTimeout(() => completeAndNext(4), 1000);
            } else {
                document.getElementById('feedback-proc').innerHTML = "<span class='error'>Falsch.</span>";
            }
        }

        // --- 4. MIS SEQUENCING ---
        const misSteps = [
            { id: 1, text: "Festlegung Informationsbedarf" },
            { id: 2, text: "Datenbeschaffung" }, /* Removed (Intern/Ext/Forsch) */
            { id: 3, text: "Analyse und Nutzung" },
            { id: 4, text: "Customer Insights" }
        ];
        function initMISGame() {
            const container = document.getElementById('list-mis');
            container.innerHTML = '';
            [...misSteps].sort(() => Math.random() - 0.5).forEach((step, i) => {
                const el = document.createElement('div');
                el.className = 'draggable-step';
                el.draggable = true;
                // Removed :: prefix
                el.innerHTML = `<span>${step.text}</span>`;
                el.dataset.id = step.id;
                el.addEventListener('dragstart', dragStart);
                el.addEventListener('dragover', dragOver);
                el.addEventListener('drop', dragDropGeneric);
                el.addEventListener('dragenter', dragEnter);
                
                const slot = document.createElement('div');
                slot.className = 'sequence-slot';
                slot.innerHTML = `<div style="width:100px; text-align:right; border-right:1px solid #ccc; padding-right:10px;">Schritt ${i+1}</div>`;
                slot.appendChild(el);
                container.appendChild(slot);
            });
        }
        function checkMISOrder() {
            const steps = document.querySelectorAll('#list-mis .draggable-step');
            let correct = 0;
            steps.forEach((s, i) => { if(parseInt(s.dataset.id) === i+1) correct++; });
            if(correct === 4) {
                document.getElementById('feedback-mis').innerHTML = "<span class='success'>Korrekt!</span>";
                setTimeout(() => completeAndNext(5), 1000);
            } else {
                document.getElementById('feedback-mis').innerHTML = "<span class='error'>Falsch.</span>";
            }
        }

        // --- 5. MIXER (Refactored for Data Choice) ---
        const mixerScenarios = [
            {
                title: "Allgemeiner √úberblick",
                desc: "Sie m√∂chten sich schnell und g√ºnstig einen ersten Markt√ºberblick verschaffen.",
                correct: 'a', // Sekund√§r
                explanation: "Sekund√§rdaten sind bereits vorhanden (z.B. Statistiken) und daher schneller und g√ºnstiger."
            },
            {
                title: "Geschmackstest",
                desc: "Sie m√∂chten wissen, wie Ihre neue Limonade den Kunden schmeckt.", /* Changed text */
                correct: 'b', // Prim√§r
                explanation: "Hierf√ºr m√ºssen neue Daten speziell erhoben werden (Prim√§rforschung), da keine Daten dazu existieren."
            },
            {
                title: "Bev√∂lkerungsdaten",
                desc: "Sie ben√∂tigen offizielle Einwohnerzahlen nach Alter f√ºr eine Region (vom Statistischen Bundesamt).",
                correct: 'a', // Sekund√§r
                explanation: "Daten vom Statistischen Bundesamt sind typische Sekund√§rdaten (bereits erhoben)."
            },
            {
                title: "Neues Logo",
                desc: "Sie wollen Feedback zu drei verschiedenen Entw√ºrfen f√ºr Ihr Firmenlogo.",
                correct: 'b', // Prim√§r
                explanation: "Spezifisches Feedback zu Ihrem neuen Logo muss neu erhoben werden."
            }
        ];
        
        function initMixerGame() {
            const container = document.getElementById('mix-game');
            container.innerHTML = '';
            mixerScenarios.forEach((scen, idx) => {
                const stepDiv = document.createElement('div');
                stepDiv.className = `mix-step ${idx === 0 ? '' : 'hidden'}`;
                stepDiv.id = `mix-step-${idx + 1}`;
                stepDiv.innerHTML = `
                    <h3 style="text-align:center; color: var(--accent-silver); margin-bottom: 5px;">${scen.title}</h3>
                    <p style="text-align:center; margin-bottom:15px; font-style:italic;">${scen.desc}</p>
                    <div class="mixer-grid">
                        <div class="mixer-card" onclick="selectMix(${idx + 1}, 'a', this)">
                            <span class="mixer-icon">üìâ</span>
                            <h3>Sekund√§rdaten</h3>
                        </div>
                        <div class="mixer-card" onclick="selectMix(${idx + 1}, 'b', this)">
                            <span class="mixer-icon">üìã</span>
                            <h3>Prim√§rdaten</h3>
                        </div>
                    </div>
                `;
                container.appendChild(stepDiv);
            });
        }

        function selectMix(stepIdx, choice, el) {
            // Remove previous selection visual
            el.parentElement.querySelectorAll('.mixer-card').forEach(c => c.classList.remove('selected'));
            el.classList.add('selected');
            
            const scen = mixerScenarios[stepIdx - 1];
            const fb = document.getElementById('feedback-mix');
            
            if(choice === scen.correct) {
                fb.innerHTML = `<span class='success'>Richtig!</span><span class='explanation-text'>${scen.explanation}</span>`;
                // No automatic forwarding. Show next button.
                // Check if it's the last one
                if(stepIdx < mixerScenarios.length) {
                    fb.innerHTML += `<button class="btn btn-step" onclick="nextMixStep(${stepIdx})">N√§chstes Szenario</button>`;
                } else {
                    document.getElementById('btn-next-mix').style.display = 'inline-block';
                }
            } else {
                fb.innerHTML = `<span class='error'>Nicht optimal.</span><span class='explanation-text'>${scen.explanation}</span>`;
            }
        }

        function nextMixStep(currentStepIdx) {
            document.getElementById('feedback-mix').innerHTML = ""; // Clear feedback
            const current = document.getElementById(`mix-step-${currentStepIdx}`);
            const next = document.getElementById(`mix-step-${currentStepIdx + 1}`);
            if(next) {
                current.classList.add('hidden');
                next.classList.remove('hidden');
            }
        }

        // --- 6. CONTACT SCENARIO (Updated Terms) ---
        const contScenarios = [
            { 
                t: "Gro√üe Datenmenge, geringe Kosten.", 
                opts: [{t:"Pers√∂nliches Interview",c:false}, {t:"Internet (online)",c:true}],
                expl: "Online-Befragungen sind sehr kosteneffizient und erreichen schnell viele Menschen, w√§hrend pers√∂nliche Interviews sehr teuer sind."
            },
            { 
                t: "Kein Einfluss durch Interviewer.", 
                opts: [{t:"Telefoninterview",c:false}, {t:"Schriftlicher Fragebogen (per Post)",c:true}],
                expl: "Bei schriftlichen Frageb√∂gen gibt es keinen Interviewer, der durch Tonfall oder Mimik die Antworten beeinflussen k√∂nnte (Interviewer Bias)."
            },
            { 
                t: "Schnelle Ergebnisse n√∂tig.", 
                opts: [{t:"Internet (online)",c:true}, {t:"Schriftlicher Fragebogen (per Post)",c:false}],
                expl: "Online-Daten stehen sofort digital zur Verf√ºgung. Postwege und manuelle Erfassung dauern deutlich l√§nger."
            },
            { 
                t: "Komplexe Fragen mit Nachfragem√∂glichkeit.", 
                opts: [{t:"Pers√∂nliches Interview",c:true}, {t:"Internet (online)",c:false}],
                expl: "Pers√∂nliche Interviewer k√∂nnen bei Verst√§ndnisproblemen helfen, komplexe Sachverhalte erkl√§ren und R√ºckfragen stellen."
            },
            { 
                t: "Hohe Antwortquote bei spezifischer Zielgruppe.", 
                opts: [{t:"Telefoninterview",c:true}, {t:"Schriftlicher Fragebogen (per Post)",c:false}],
                expl: "Telefoninterviews haben oft h√∂here R√ºcklaufquoten als reine Postaussendungen, da der direkte Kontakt eine Ablehnung erschwert."
            }
        ];
        let curContIdx = 0;
        function initContactGame() {
            curContIdx = 0;
            showContactScenario();
        }
        function showContactScenario() {
            const container = document.getElementById('contact-game-container');
            const scen = contScenarios[curContIdx];
            if(!scen) {
                document.getElementById('feedback-cont').innerHTML = "<span class='success'>Alle gel√∂st!</span>";
                document.getElementById('btn-next-cont').style.display = 'inline-block';
                container.innerHTML = "";
                return;
            }
            container.innerHTML = `
                <div class="scenario-box">Szenario ${curContIdx+1}:<br><strong>${scen.t}</strong></div>
                <div class="options-grid">
                    <div class="option-card" onclick="checkContact(0)">${scen.opts[0].t}</div>
                    <div class="option-card" onclick="checkContact(1)">${scen.opts[1].t}</div>
                </div>
            `;
        }
        function checkContact(optIdx) {
            const scen = contScenarios[curContIdx];
            const fb = document.getElementById('feedback-cont');
            if(scen.opts[optIdx].c) {
                fb.innerHTML = `<span class='success'>Richtig!</span><span class='explanation-text'>${scen.expl}</span>`;
                // No auto forward
                if(curContIdx < contScenarios.length - 1) {
                    fb.innerHTML += `<button class="btn btn-step" onclick="nextContactStep()">N√§chstes Szenario</button>`;
                } else {
                    // Last one
                     fb.innerHTML += `<button class="btn btn-step" onclick="nextContactStep()">Fertigstellen</button>`;
                }
            } else {
                fb.innerHTML = `<span class='error'>Falsch.</span><span class='explanation-text'>${scen.expl}</span>`;
            }
        }
        function nextContactStep() {
            document.getElementById('feedback-cont').innerHTML = "";
            curContIdx++;
            showContactScenario();
        }

        // --- 7. SAMPLING SORTING ---
        const sampItems = [
            { t: "Einfache Zufallsauswahl", type: "zufall", expl: "Jedes Element der Grundgesamtheit hat die gleiche Wahrscheinlichkeit, ausgew√§hlt zu werden." },
            { t: "Willk√ºrliche Auswahl", type: "nicht-zufall", expl: "Auswahl erfolgt nach Bequemlichkeit (z.B. Passanten auf der Stra√üe), nicht repr√§sentativ." },
            { t: "Geschichtete Auswahl", type: "zufall", expl: "Die Grundgesamtheit wird in Gruppen (Schichten) geteilt, aus denen dann zuf√§llig gezogen wird (z.B. nach Alter)." },
            { t: "Quota-Verfahren", type: "nicht-zufall", expl: "Interviewern werden Quoten vorgegeben (z.B. 50% Frauen), die Auswahl der konkreten Person obliegt aber dem Interviewer." },
            { t: "Fl√§chenauswahlverfahren", type: "zufall", expl: "Geografische Einheiten (Cluster) werden zuf√§llig ausgew√§hlt." },
            { t: "Beurteilungsauswahl", type: "nicht-zufall", expl: "Experten w√§hlen gezielt Personen aus, die sie f√ºr geeignet halten ('conscious selection')." }
        ];
        let curSampIdx = 0;
        function initSamplingGame() {
            curSampIdx = 0;
            loadSampCard();
        }
        function loadSampCard() {
            const stack = document.getElementById('stack-samp');
            stack.innerHTML = '';
            if(curSampIdx >= sampItems.length) {
                document.getElementById('feedback-samp').innerHTML = "<span class='success'>Fertig!</span>";
                document.getElementById('btn-next-samp').style.display = 'inline-block';
                return;
            }
            const item = sampItems[curSampIdx];
            const card = document.createElement('div');
            card.className = 'card';
            card.draggable = true;
            card.innerText = item.t;
            card.dataset.type = item.type;
            card.addEventListener('dragstart', (e) => e.dataTransfer.setData("text", item.type));
            stack.appendChild(card);
        }
        function allowDropSamp(ev) { ev.preventDefault(); ev.currentTarget.classList.add('drag-over'); }
        function dropSamp(ev) {
            ev.preventDefault();
            ev.currentTarget.classList.remove('drag-over');
            const type = ev.dataTransfer.getData("text");
            const fb = document.getElementById('feedback-samp');
            const item = sampItems[curSampIdx];

            if(type === ev.currentTarget.dataset.type) {
                fb.innerHTML = `<span class='success'>Richtig!</span><span class='explanation-text'>${item.expl}</span>`;
                // Add button for manual advance
                fb.innerHTML += `<button class="btn btn-step" onclick="nextSampStep()">N√§chste Frage</button>`;
            } else {
                fb.innerHTML = `<span class='error'>Falsch.</span><span class='explanation-text'>${item.expl}</span>`;
            }
        }
        
        function nextSampStep() {
            document.getElementById('feedback-samp').innerHTML = "";
            curSampIdx++;
            loadSampCard();
        }

        // --- 8. INSTRUMENTS QUIZ ---
        const quizQs = [
            { q: "Stichprobenauswahl verlangt: Wer, Welches Verfahren und ...?", opts: ["Wann", "Wie viele", "Warum"], c: 1, expl: "Ein Stichprobenplan muss definieren: Wen befragen wir (Einheit), wie w√§hlen wir aus (Verfahren) und wie viele (Gr√∂√üe)." },
            { q: "Vorteil offener Fragen?", opts: ["Einfache Auswertung", "Mehr Antwortfreiheit", "Schneller"], c: 1, expl: "Offene Fragen geben den Befragten die M√∂glichkeit, unbeeinflusst und detailliert in eigenen Worten zu antworten." },
            { q: "Technisches Instrument?", opts: ["Likert-Skala", "Eye-Tracking", "Panel"], c: 1, expl: "Eye-Tracking (Blickaufzeichnung) ist ein apparatives Verfahren zur Messung der Aufmerksamkeit." },
            { q: "Welche Frageform erm√∂glicht Skalenbewertungen?", opts: ["Ja/Nein-Frage", "Semantisches Differential", "Offene Frage"], c: 1, expl: "Das Semantische Differential (Polarit√§tenprofil) nutzt eine Skala zwischen zwei gegens√§tzlichen Eigenschaftsw√∂rtern." },
            { q: "Was ist ein Nachteil von Beobachtungsstudien?", opts: ["Hohe Kosten", "Gef√ºhle nicht messbar", "Zu komplex"], c: 1, expl: "Man kann zwar das Verhalten sehen, aber nicht die inneren Motive, Einstellungen oder Gef√ºhle, die dazu f√ºhren." },
            { q: "Wof√ºr eignen sich Experimente besonders?", opts: ["Beschreibung", "Kausalzusammenh√§nge", "Erste Einblicke"], c: 1, expl: "Experimente (Ursachenforschung) sind ideal, um Wenn-Dann-Beziehungen (Kausalit√§ten) zu testen." }
        ];
        let curQuizIdx = 0;
        function initQuizGame() {
            curQuizIdx = 0;
            showQuiz();
        }
        function showQuiz() {
            const container = document.getElementById('quiz-container');
            const q = quizQs[curQuizIdx];
            if(!q) {
                document.getElementById('feedback-inst').innerHTML = "<span class='success'>Quiz beendet!</span>";
                document.getElementById('btn-next-inst').style.display = 'inline-block';
                container.innerHTML = "";
                return;
            }
            let html = `<div style="margin-bottom:15px; font-size:1.2rem;">${q.q}</div>`;
            q.opts.forEach((opt, i) => {
                html += `<div class="quiz-option" onclick="checkQuiz(${i})">${opt}</div>`;
            });
            container.innerHTML = html;
        }
        function checkQuiz(i) {
            const q = quizQs[curQuizIdx];
            const els = document.querySelectorAll('.quiz-option');
            const fb = document.getElementById('feedback-inst');
            
            // Mark correct/wrong visually
            els.forEach((el, idx) => {
                if(idx === q.c) el.classList.add('selected-correct'); // Always show correct one
                if(idx === i && i !== q.c) el.classList.add('selected-wrong');
            });

            if(i === q.c) {
                fb.innerHTML = `<span class='success'>Richtig!</span><span class='explanation-text'>${q.expl}</span>`;
            } else {
                fb.innerHTML = `<span class='error'>Falsch.</span><span class='explanation-text'>${q.expl}</span>`;
            }
            
            // Manual advance button
            fb.innerHTML += `<button class="btn btn-step" onclick="nextQuizStep()">N√§chste Frage</button>`;
        }
        
        function nextQuizStep() {
            document.getElementById('feedback-inst').innerHTML = "";
            curQuizIdx++;
            showQuiz();
        }

    </script>
</body>
</html>